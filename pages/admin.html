<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS System - Admin</title>
    <link rel="stylesheet" href="../css/styles.css">
    <!-- 添加字体图标 -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <!-- 修复侧边栏白边问题的样式 -->
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .pos-container {
            display: flex;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        .sidebar {
            min-width: 250px;
            height: 100vh;
        }
        .content {
            flex: 1;
            height: 100vh;
            overflow-y: auto;
        }
        /* 新增的管理员信息样式 */
        .admin-profile {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .admin-profile-header {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
        }
        .admin-avatar {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
        .admin-avatar img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .admin-title {
            text-align: center;
            width: 100%;
        }
        .admin-title h2 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            color: white;
        }
        .admin-info {
            width: 100%;
            font-size: 14px;
        }
        .admin-info p {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }
        .admin-info .material-icons {
            font-size: 16px;
            margin-right: 5px;
        }
        .admin-actions {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
        }
        .admin-action-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 4px;
            padding: 5px 8px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        .admin-action-btn .material-icons {
            font-size: 14px;
            margin-right: 4px;
        }
        .admin-action-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        /* 通知徽章样式 */
        .notification-badge {
            background-color: #ff5252;
            color: white;
            border-radius: 50%;
            min-width: 16px;
            height: 16px;
            font-size: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 5px;
            padding: 0 4px;
            font-weight: bold;
        }
        /* 星级评分样式 */
        .star-rating {
            color: #FFD700; /* 黄色星星 */
            display: inline-flex;
            align-items: center;
        }
        .star-rating .material-icons {
            font-size: 14px;
            margin-right: 2px;
            animation: twinkle 1.5s infinite alternate;
        }
        /* 星星闪烁动画 */
        @keyframes twinkle {
            0% {
                opacity: 0.5;
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1.1);
            }
        }
        /* 使星星交错闪烁 */
        .star-rating .material-icons:nth-child(1) {
            animation-delay: 0s;
        }
        .star-rating .material-icons:nth-child(2) {
            animation-delay: 0.3s;
        }
        .star-rating .material-icons:nth-child(3) {
            animation-delay: 0.6s;
        }
        .star-rating .material-icons:nth-child(4) {
            animation-delay: 0.9s;
        }
        .star-rating .material-icons:nth-child(5) {
            animation-delay: 1.2s;
        }
        /* 星星注释说明样式 */
        .star-note {
            font-size: 10px;
            color: #aaa;
            margin-top: 0;
            margin-bottom: 8px;
            padding-left: 21px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="pos-container">
        <div class="sidebar">
            <div class="admin-profile">
                <div class="admin-profile-header">
                    <div class="admin-avatar">
                        <img src="../icons/pos.png" alt="SmartProfits Logo">
                    </div>
                    <div class="admin-title">
                        <h2>SmartProfits</h2>
                    </div>
                </div>
                <div class="admin-info">
                    <p><i class="material-icons">person_outline</i><span id="adminName">User</span></p>
                    <p><i class="material-icons">email</i><span id="adminEmail">loading@example.com</span></p>
                    <p><i class="material-icons">verified_user</i><span id="adminRole">Admin</span></p>
                    <p><i class="material-icons">trending_up</i>Sales Rate: <span id="adminSalesRate" class="star-rating">Loading...</span></p>
                    <p class="star-note">One star equals RM 10,000</p>
                </div>
            </div>
            <div class="nav-menu">
                <div>
                <div class="nav-item active" data-view="dashboard"><i class="material-icons">dashboard</i> Dashboard</div>
                </div>
                <div class="nav-item" data-view="stores"><i class="material-icons">store</i> Stores</div>
                <div class="nav-item" data-view="products"><i class="material-icons">inventory</i> Products</div>
                <div class="nav-item" data-view="inventory"><i class="material-icons">inventory_2</i> Inventory</div>
                <div class="nav-item" onclick="location.href='./product_catalog.html'"><i class="material-icons">menu_book</i> Product Catalog</div>
                <div class="nav-item" data-view="users"><i class="material-icons">people</i> Users</div>
                <div class="nav-item sadmin-only" data-view="online-users"><i class="material-icons">online_prediction</i> Online Users</div>
                <div class="nav-item sadmin-only" data-view="announcement"><i class="material-icons">campaign</i> Announce</div>
                <div class="nav-item sadmin-only" id="maintenanceToggle"><i class="material-icons">build</i> System Maintenance</div>
                <div class="nav-item" onclick="logout()"><i class="material-icons">logout</i> Logout</div>
            </div>
        </div>
        
        <div class="content">
            <div class="header">
                <h1 id="viewTitle">Dashboard</h1>
                <div id="currentDateTime"></div>
            </div>
            
            <!-- Dashboard View -->
            <div id="dashboardView" class="view active">
                <div class="dashboard-header">
                    <div class="date-selector">
                        <label for="dateFilter"><i class="material-icons">event</i></label>
                    <input type="date" id="dateFilter" value="">
                    </div>
                    
                    <div class="dashboard-actions">
                        <button id="refreshStatsBtn" class="icon-button" title="刷新数据">
                            <i class="material-icons">refresh</i>
                        </button>
                        <button id="viewSalesSummaryBtn" class="action-button">
                            <i class="material-icons">assessment</i>
                            <span>Sales Summary</span>
                        </button>
                    </div>
                </div>
                
                <div class="store-buttons-container">
                    <div class="store-buttons-label"><i class="material-icons">store</i> Store:</div>
                    <div class="store-buttons" id="storeButtons">
                        <button class="store-button active" data-store="all">All Stores</button>
                        <!-- Store buttons will be loaded dynamically -->
                    </div>
                </div>
                
                <div class="stats-container" id="statsContainer">
                    <!-- Stat cards will be loaded dynamically -->
                </div>
                
                <h2>Sales Details</h2>
                <div class="sale-details-container">
                    <table id="saleDetailsTable">
                        <thead>
                            <tr>
                                <th>Bill Number</th>
                                <th>Store</th>
                                <th>Time</th>
                                <th>Cashier</th>
                                <th>Shift</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="saleDetailsBody">
                            <!-- Sale details will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Stores Management View -->
            <div id="storesView" class="view">
                <h2>Store Management</h2>
                
                <div class="page-header">
                    <div class="header-title">
                        <span>Manage all your retail locations</span>
                    </div>
                    <div class="header-actions">
                        <button id="addStoreBtn" class="action-button">
                            <i class="material-icons">add_business</i>
                            <span>Add Store</span>
                        </button>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <table id="storesTable">
                        <thead>
                            <tr>
                                <th>Store ID</th>
                                <th>Store Name</th>
                                <th>Address</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="storesTableBody">
                            <!-- Store list will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Products Management View -->
            <div id="productsView" class="view">
                <h2>Product Management</h2>
                
                <div class="page-header">
                    <div class="filter-section">
                        <div class="filter-item">
                            <label for="productStoreFilter">
                                <i class="material-icons">store</i>
                                <span>Store</span>
                            </label>
                            <select id="productStoreFilter">
                                <option value="all">All Stores</option>
                                <!-- Store options will be loaded dynamically -->
                            </select>
                        </div>
                        
                        <div class="filter-item">
                            <label for="productCategoryFilter">
                                <i class="material-icons">category</i>
                                <span>Category</span>
                            </label>
                            <select id="productCategoryFilter">
                                <option value="all">All Categories</option>
                                <!-- Category options will be loaded dynamically -->
                            </select>
                        </div>
                        
                        <div class="filter-item">
                            <label for="productSearch">
                                <i class="material-icons">search</i>
                                <span>Search</span>
                            </label>
                            <input type="text" id="productSearch" placeholder="Search products...">
                        </div>
                        
                        <div class="filter-item">
                            <label for="productPromotionFilter">
                                <i class="material-icons">local_offer</i>
                                <span>Promotion</span>
                            </label>
                            <select id="productPromotionFilter">
                                <option value="all">All Products</option>
                                <option value="promotion">With Promotion</option>
                                <option value="no-promotion">No Promotion</option>
                            </select>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button id="addProductBtn" class="action-button">
                            <i class="material-icons">add_shopping_cart</i>
                            <span>Add Product</span>
                        </button>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <table id="productsTable">
                        <thead>
                            <tr>
                                <th>Product ID</th>
                                <th>Product Name</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Category</th>
                                <th>Store</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Product list will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Users Management View -->
            <div id="usersView" class="view">
                <h2>User Management</h2>
                
                <div class="page-header">
                    <div class="header-title">
                        <span>Manage user accounts and permissions</span>
                    </div>
                    <div class="header-actions">
                        <button id="addUserBtn" class="action-button">
                            <i class="material-icons">person_add</i>
                            <span>Add User</span>
                        </button>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Store</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- User list will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Inventory Management View -->
            <div id="inventoryView" class="view">
                <h2>Inventory Management</h2>
                
                <div class="inventory-header">
                    <div class="inventory-filters">
                        <div class="filter-item">
                            <label for="inventoryStoreFilter">
                                <i class="material-icons">store</i>
                                <span>Store</span>
                            </label>
                    <select id="inventoryStoreFilter">
                        <option value="all">All Stores</option>
                        <!-- Store options will be loaded dynamically -->
                    </select>
                        </div>
                        
                        <div class="filter-item">
                            <label for="inventoryCategoryFilter">
                                <i class="material-icons">category</i>
                                <span>Category</span>
                            </label>
                    <select id="inventoryCategoryFilter">
                        <option value="all">All Categories</option>
                        <!-- Category options will be loaded dynamically -->
                    </select>
                        </div>
                        
                        <div class="filter-item">
                            <label for="inventoryStockFilter">
                                <i class="material-icons">warning</i>
                                <span>Stock Status</span>
                            </label>
                    <select id="inventoryStockFilter">
                        <option value="all">All</option>
                        <option value="low">Low Stock</option>
                        <option value="out">Out of Stock</option>
                    </select>
                        </div>
                    </div>
                    
                    <div class="inventory-actions">
                        <button id="refreshInventoryBtn" class="icon-button" title="刷新库存">
                            <i class="material-icons">refresh</i>
                        </button>
                        <button id="bulkUpdateBtn" class="action-button">
                            <i class="material-icons">update</i>
                            <span>Bulk Update</span>
                        </button>
                        <div class="dropdown">
                            <button class="action-button dropdown-toggle">
                                <i class="material-icons">more_horiz</i>
                            </button>
                            <div class="dropdown-menu">
                                <button id="exportInventoryBtn" class="dropdown-item">
                                    <i class="material-icons">download</i>
                                    <span>Export</span>
                                </button>
                                <button id="importInventoryBtn" class="dropdown-item">
                                    <i class="material-icons">upload</i>
                                    <span>Import</span>
                                </button>
                            </div>
                        </div>
                </div>
                </div>
                
                <div class="inventory-table-container">
                    <table id="inventoryTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllInventory"></th>
                                <th>Product ID</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Current Stock</th>
                                <th>Status</th>
                                <th>Store</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                            <!-- Inventory list will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Online Users View -->
            <div id="online-usersView" class="view">
                <h2>Online Users</h2>
                
                <div class="page-header">
                    <div class="header-title">
                        <span>View all users currently online in the system</span>
                    </div>
                    <div class="header-actions">
                        <button id="refreshOnlineUsersBtn" class="icon-button" title="Refresh online users list">
                            <i class="material-icons">refresh</i>
                        </button>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <table id="onlineUsersTable">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Current Activity</th>
                                <th>Last Online Time</th>
                            </tr>
                        </thead>
                        <tbody id="onlineUsersTableBody">
                            <!-- Online user list will be dynamically generated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Announcement Management View -->
            <div id="announcementView" class="view">
                <h2>Announcement Management</h2>
                
                <div class="page-header">
                    <div class="header-title">
                        <span>Manage announcements displayed on POS screens</span>
                    </div>
                    <div class="header-actions">
                        <button id="addAnnouncementBtn" class="action-button">
                            <i class="material-icons">add</i>
                            <span>Create Announcement</span>
                        </button>
                    </div>
                </div>
                
                <div class="announcement-status-card">
                    <div class="status-card-header">
                        <h3><i class="material-icons">info</i> Current Status</h3>
                        <div class="status-toggle">
                            <label class="switch">
                                <input type="checkbox" id="announcementGlobalToggle">
                                <span class="slider round"></span>
                            </label>
                            <span id="announcementStatus">Disabled</span>
                        </div>
                    </div>
                    <div class="current-announcement-preview" id="currentAnnouncementPreview">
                        <div class="preview-label">Current Announcement:</div>
                        <div class="preview-content" id="previewContent">
                            <span class="no-announcement">No active announcement</span>
                        </div>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <table id="announcementsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Text</th>
                                <th>Font Style</th>
                                <th>Created</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="announcementsTableBody">
                            <!-- Announcement list will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sale Detail Modal -->
    <div id="saleDetailModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="material-icons">receipt</i> Sale Details</h2>
            <div class="sale-detail-container">
                <div class="sale-detail-header">
                    <p><strong>Bill Number:</strong> <span id="sale-detail-bill">-</span></p>
                    <p><strong>Store:</strong> <span id="sale-detail-store">-</span></p>
                    <p><strong>Time:</strong> <span id="sale-detail-date">-</span></p>
                    <p><strong>Cashier:</strong> <span id="sale-detail-cashier">-</span></p>
                    <p><strong>Shift:</strong> <span id="sale-detail-shift">-</span></p>
                </div>
                <table class="sale-detail-table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody id="sale-details-items">
                        <!-- Sale items will be loaded dynamically -->
                    </tbody>
                </table>
                <div id="sale-detail-footer">
                    <!-- Sale summary (subtotal, discount, total) will be loaded dynamically -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Store Modal -->
    <div id="addStoreModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="material-icons">add_business</i> Add Store</h2>
            <form id="addStoreForm">
                <div class="form-group">
                    <label for="storeId"><i class="material-icons">tag</i> Store ID:</label>
                    <input type="text" id="storeId" required>
                </div>
                <div class="form-group">
                    <label for="storeName"><i class="material-icons">store</i> Store Name:</label>
                    <input type="text" id="storeName" required>
                </div>
                <div class="form-group">
                    <label for="storeAddress"><i class="material-icons">location_on</i> Address:</label>
                    <input type="text" id="storeAddress" required>
                </div>
                <button type="submit"><i class="material-icons">save</i> Save</button>
            </form>
        </div>
    </div>
    
    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="material-icons">add_shopping_cart</i> Add Product</h2>
            <form id="addProductForm">
                <div class="form-group">
                    <label for="productId"><i class="material-icons">tag</i> Product ID:</label>
                    <input type="text" id="productId" required>
                </div>
                <div class="form-group">
                    <label for="productName"><i class="material-icons">inventory</i> Product Name:</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label for="productPrice"><i class="material-icons">attach_money</i> Price:</label>
                    <input type="number" id="productPrice" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="productPromotionEnabled" style="width: auto;">
                        <span><i class="material-icons">local_offer</i> Enable Promotion Price</span>
                    </label>
                </div>
                <div class="form-group" id="productPromotionPriceGroup" style="display: none;">
                    <label for="productPromotionPrice"><i class="material-icons">sell</i> Promotion Price:</label>
                    <input type="number" id="productPromotionPrice" step="0.01" min="0" placeholder="Enter promotion price">
                </div>
                <div class="form-group">
                    <label for="productQuantity"><i class="material-icons">inventory_2</i> Stock:</label>
                    <input type="number" id="productQuantity" min="0" value="0" step="0.001">
                </div>
                <div class="form-group">
                    <label for="productCategory"><i class="material-icons">category</i> Category:</label>
                    <input type="text" id="productCategory">
                </div>
                <div class="form-group">
                    <label for="productStoreId"><i class="material-icons">store</i> Store:</label>
                    <select id="productStoreId" required>
                        <option value="">Select Store</option>
                        <!-- Store options will be loaded dynamically -->
                    </select>
                </div>
                <button type="submit"><i class="material-icons">save</i> Save</button>
            </form>
        </div>
    </div>
    
    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="material-icons">person_add</i> Add User</h2>
            <form id="addUserForm">
                <div class="form-group">
                    <label for="userEmail"><i class="material-icons">email</i> Email:</label>
                    <input type="email" id="userEmail" required>
                </div>
                <div class="form-group">
                    <label for="userName"><i class="material-icons">badge</i> Name:</label>
                    <input type="text" id="userName" placeholder="User's full name">
                </div>
                <div class="form-group">
                    <label for="userPassword"><i class="material-icons">lock</i> Password:</label>
                    <input type="password" id="userPassword" required>
                </div>
                <div class="form-group">
                    <label for="userRole"><i class="material-icons">assignment_ind</i> Role:</label>
                    <select id="userRole" required>
                        <option value="staff">Staff</option>
                        <option value="admin">Admin</option>
                        <option value="sadmin">Super Admin</option>
                    </select>
                </div>
                <div class="form-group" id="userStoreContainer">
                    <label for="userStoreId"><i class="material-icons">store</i> Store:</label>
                    <select id="userStoreId">
                        <option value="">Select Store</option>
                        <!-- Store options will be loaded dynamically -->
                    </select>
                </div>
                <button type="submit"><i class="material-icons">save</i> Save</button>
            </form>
        </div>
    </div>
    
    <!-- Update Stock Modal -->
    <div class="modal" id="updateStockModal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="material-icons">edit</i> Update Stock</h2>
            <form id="updateStockForm">
                <input type="hidden" id="updateProductId">
                
                <div class="form-group">
                    <label for="updateProductName">Product Name:</label>
                    <input type="text" id="updateProductName" readonly>
                </div>
                
                <div class="form-group">
                    <label for="updateCurrentStock">Current Stock:</label>
                    <input type="number" id="updateCurrentStock" readonly>
                </div>
                
                <div class="form-group">
                    <label for="updateOperation">Operation:</label>
                    <select id="updateOperation">
                        <option value="add">Add Stock</option>
                        <option value="subtract">Remove Stock</option>
                        <option value="set">Set Stock Value</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="updateQuantity">Quantity:</label>
                    <input type="number" id="updateQuantity" min="0.001" value="1" step="0.001" required>
                </div>
                
                <div class="form-group">
                    <label for="updateReason">Reason:</label>
                    <select id="updateReason" onchange="toggleOtherReason()">
                        <option value="new_stock">New Stock</option>
                        <option value="returned">Returned Items</option>
                        <option value="damaged">Damaged/Lost</option>
                        <option value="correction">Inventory Correction</option>
                        <option value="expired">Expired</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group" id="otherReasonContainer" style="display: none;">
                    <label for="otherReason">Specify Reason:</label>
                    <input type="text" id="otherReason">
                </div>
                
                <div class="form-group">
                    <label for="updateNotes">Notes:</label>
                    <textarea id="updateNotes" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn-primary"><i class="material-icons">save</i> Update Stock</button>
            </form>
        </div>
    </div>
    
    <!-- Bulk Update Modal -->
    <div class="modal" id="bulkUpdateModal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="material-icons">group_work</i> Bulk Update Stock</h2>
            
            <div class="selected-products-summary">
                <p>Selected Products: <span id="selectedProductsCount">0</span></p>
            </div>
            
            <div class="selected-products-list" id="selectedProductsList">
                <!-- 选中的产品将在此显示 -->
            </div>
            
            <form id="bulkUpdateForm">
                <div class="form-group">
                    <label for="bulkUpdateOperation">Operation:</label>
                    <select id="bulkUpdateOperation">
                        <option value="add">Add Stock</option>
                        <option value="subtract">Remove Stock</option>
                        <option value="percentage">Adjust by Percentage (%)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="bulkUpdateQuantity">Quantity/Percentage:</label>
                    <input type="number" id="bulkUpdateQuantity" min="0.001" value="1" step="0.001" required>
                </div>
                
                <div class="form-group">
                    <label for="bulkUpdateReason">Reason:</label>
                    <select id="bulkUpdateReason" onchange="toggleBulkOtherReason()">
                        <option value="new_stock">New Stock</option>
                        <option value="returned">Returned Items</option>
                        <option value="damaged">Damaged/Lost</option>
                        <option value="correction">Inventory Correction</option>
                        <option value="expired">Expired</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group" id="bulkOtherReasonContainer" style="display: none;">
                    <label for="bulkOtherReason">Specify Reason:</label>
                    <input type="text" id="bulkOtherReason">
                </div>
                
                <div class="form-group">
                    <label for="bulkUpdateNotes">Notes:</label>
                    <textarea id="bulkUpdateNotes" rows="3"></textarea>
                </div>
                
                <button type="submit" class="btn-primary"><i class="material-icons">save</i> Update Stock</button>
            </form>
        </div>
    </div>
    
    <!-- Sales Summary Modal -->
    <div id="salesSummaryModal" class="modal sales-summary-fullscreen">
        <div class="modal-content sales-summary-modal">
            <div class="modal-header">
                <h2><i class="material-icons">assessment</i> Sales Summary Report</h2>
            <span class="close">&times;</span>
            </div>
            
            <!-- 可滚动内容容器 -->
            <div class="sales-summary-scrollable">
            
            <!-- 汇总控制面板 -->
            <div class="summary-control-panel">
                <div class="control-section">
                    <div class="control-group">
                        <label><i class="material-icons">view_module</i> View Mode</label>
                        <div class="view-mode-selector">
                            <button class="view-mode-btn active" data-mode="table">
                                <i class="material-icons">table_chart</i>
                                <span>Table</span>
                            </button>
                            <button class="view-mode-btn" data-mode="heatmap">
                                <i class="material-icons">grid_on</i>
                                <span>Heatmap</span>
                            </button>
                            <button class="view-mode-btn" data-mode="chart">
                                <i class="material-icons">bar_chart</i>
                                <span>Chart</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label><i class="material-icons">sort</i> Sort By</label>
                <select id="summarySortBy">
                    <option value="quantity">Sort by Quantity</option>
                    <option value="revenue">Sort by Revenue</option>
                    <option value="name">Sort by Name</option>
                            <option value="profit">Sort by Profit</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label><i class="material-icons">filter_list</i> Filter Options</label>
                        <div class="filter-options">
                            <select id="summaryCategory">
                                <option value="all">All Categories</option>
                                <!-- Category options will be loaded dynamically -->
                            </select>
                            <select id="summaryMinQuantity">
                                <option value="0">Min Quantity</option>
                                <option value="1">≥ 1</option>
                                <option value="5">≥ 5</option>
                                <option value="10">≥ 10</option>
                                <option value="20">≥ 20</option>
                </select>
                        </div>
                    </div>
                </div>
                
                <div class="action-section">
                    <label><i class="material-icons">more_horiz</i> Actions</label>
                    <div class="action-mode-selector">
                        <button id="screenshotSummaryBtn" class="action-mode-btn">
                            <i class="material-icons">photo_camera</i>
                            <span>Screenshot</span>
                        </button>
                        <button id="exportSummaryBtn" class="action-mode-btn">
                            <i class="material-icons">download</i>
                            <span>Export</span>
                        </button>
                        <button id="printSummaryBtn" class="action-mode-btn">
                            <i class="material-icons">print</i>
                            <span>Print</span>
                        </button>
                    </div>
                </div>
            </div>
            

            
            <!-- 汇总内容区域 -->
            <div class="summary-content-area">
                <!-- 表格视图 -->
                <div id="summaryTableView" class="summary-view active">
                    <div class="table-container">
                        <table class="summary-table">
                            <thead>
                                <tr>
                                    <th>Product ID</th>
                                    <th>Product Name</th>
                                    <th>Unit Price</th>
                                    <th>Quantity Sold</th>
                                    <th>Revenue</th>
                                    <th>Sales Count</th>
                                    <th>Percentage</th>
                                </tr>
                            </thead>
                            <tbody id="summaryTableBody">
                                <!-- Table content will be generated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Heatmap View -->
                <div id="summaryHeatmapView" class="summary-view">
                    <div class="heatmap-container" id="summaryHeatmapContainer">
                        <div class="heatmap-legend">
                            <div class="legend-title">Sales Heatmap</div>
                            <div class="legend-scale">
                                <div class="legend-item">
                                    <div class="legend-color low"></div>
                                    <span>Low Sales</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color medium-low"></div>
                                    <span>Medium-Low Sales</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color medium-high"></div>
                                    <span>Medium-High Sales</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color high"></div>
                                    <span>High Sales</span>
                                </div>
                            </div>
                        </div>
                        <div class="heatmap-grid" id="heatmapGrid">
                            <!-- Heatmap content will be generated dynamically -->
                        </div>
                    </div>
                </div>
                
                <!-- Chart View -->
                <div id="summaryChartView" class="summary-view">
                    <div class="chart-container">
                        <div class="chart-tabs">
                            <button class="chart-tab active" data-chart="bar">Bar Chart</button>
                            <button class="chart-tab" data-chart="pie">Pie Chart</button>
                            <button class="chart-tab" data-chart="line">Line Chart</button>
                        </div>
                        <div class="chart-content">
                            <canvas id="summaryChart" width="800" height="400"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Loading State -->
            <div id="summaryLoadingState" class="loading-state">
                <div class="loading-spinner">
                    <i class="material-icons">hourglass_empty</i>
                </div>
                <div class="loading-text">Loading sales summary data...</div>
            </div>
            
            </div> <!-- 结束可滚动内容容器 -->
        </div>
    </div>
    
    <!-- Add Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="material-icons">edit</i> Edit User</h2>
            <form id="editUserForm">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label for="editUserEmail"><i class="material-icons">email</i> Email:</label>
                    <input type="email" id="editUserEmail" readonly>
                </div>
                <div class="form-group">
                    <label for="editUserName"><i class="material-icons">badge</i> Name:</label>
                    <input type="text" id="editUserName" placeholder="User's full name">
                </div>
                <div class="form-group">
                    <label for="editUserRole"><i class="material-icons">assignment_ind</i> Role:</label>
                    <select id="editUserRole">
                        <option value="staff">Staff</option>
                        <option value="admin">Admin</option>
                        <option value="sadmin">Super Admin</option>
                    </select>
                </div>
                <div class="form-group" id="editUserStoreContainer">
                    <label for="editUserStoreId"><i class="material-icons">store</i> Store:</label>
                    <select id="editUserStoreId">
                        <option value="">Select Store</option>
                        <!-- Store options will be loaded dynamically -->
                    </select>
                </div>
                <button type="submit"><i class="material-icons">save</i> Update</button>
            </form>
        </div>
    </div>
    
    <!-- Announcement Modal -->
    <div id="announcementModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="announcementModalTitle"><i class="material-icons">campaign</i> Create Announcement</h2>
            <form id="announcementForm">
                <input type="hidden" id="announcementId">
                
                <div class="form-group">
                    <label for="announcementText"><i class="material-icons">message</i> Announcement Text:</label>
                    <textarea id="announcementText" rows="3" placeholder="Enter your announcement message..." maxlength="200" required></textarea>
                    <div class="char-counter">
                        <span id="charCount">0</span>/200 characters
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="announcementFont"><i class="material-icons">font_download</i> Font Family:</label>
                    <select id="announcementFont">
                        <option value="Arial">Arial</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Trebuchet MS">Trebuchet MS</option>
                        <option value="Poppins" selected>Poppins</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="announcementSize"><i class="material-icons">format_size</i> Font Size:</label>
                    <select id="announcementSize">
                        <option value="12">12px</option>
                        <option value="14" selected>14px</option>
                        <option value="16">16px</option>
                        <option value="18">18px</option>
                        <option value="20">20px</option>
                        <option value="22">22px</option>
                        <option value="24">24px</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="announcementWeight"><i class="material-icons">format_bold</i> Font Weight:</label>
                    <select id="announcementWeight">
                        <option value="normal" selected>Normal</option>
                        <option value="bold">Bold</option>
                        <option value="lighter">Light</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="announcementColor"><i class="material-icons">palette</i> Text Color:</label>
                    <div class="color-picker-container">
                        <input type="color" id="announcementColor" value="#ffffff">
                        <input type="text" id="announcementColorText" value="#ffffff" maxlength="7">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="announcementBackground"><i class="material-icons">format_color_fill</i> Background Color:</label>
                    <div class="color-picker-container">
                        <input type="color" id="announcementBackground" value="#2196F3">
                        <input type="text" id="announcementBackgroundText" value="#2196F3" maxlength="7">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="announcementSpeed"><i class="material-icons">speed</i> Scroll Speed:</label>
                    <select id="announcementSpeed">
                        <option value="slow">Slow</option>
                        <option value="normal" selected>Normal</option>
                        <option value="fast">Fast</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="announcementAnimation"><i class="material-icons">animation</i> Background Animation:</label>
                    <select id="announcementAnimation">
                        <option value="none" selected>None (Solid Color)</option>
                        <option value="gradient-wave">Gradient Wave</option>
                        <option value="alert-pulse">Alert Pulse</option>
                        <option value="neon-glow">Neon Glow</option>
                        <option value="rainbow-shift">Rainbow Shift</option>
                        <option value="emergency-flash">Emergency Flash</option>
                        <option value="ocean-wave">Ocean Wave</option>
                        <option value="sunset-glow">Sunset Glow</option>
                        <option value="matrix-green">Matrix Green</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <div class="announcement-preview">
                        <label><i class="material-icons">preview</i> Preview:</label>
                        <div class="preview-container" id="announcementPreviewContainer">
                            <div class="scrolling-text" id="announcementScrollingPreview">
                                Your announcement will appear here...
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" id="previewAnnouncementBtn" class="action-button secondary">
                        <i class="material-icons">visibility</i>
                        <span>Preview</span>
                    </button>
                    <button type="submit" class="action-button">
                        <i class="material-icons">save</i>
                        <span>Save Announcement</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../js/firebase-config.js"></script>
    <script src="../js/database.js"></script>
    <script src="../js/network-monitor.js"></script>
    <script src="../js/sw-helper.js"></script>
    <script src="../js/admin.js"></script>
</body>
</html>